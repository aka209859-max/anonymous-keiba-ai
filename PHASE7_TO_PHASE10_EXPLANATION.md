# Phase 7〜10の説明（小学生でもわかる！）

## 🎯 競馬予測AIを作る4つのステップ

競馬で勝つ馬を予測するAIを作るとき、最後の4つのステップがあります。
それぞれ、こんな感じです：

---

## 📚 Phase 7: 「使う情報を選ぶ」

### 小学生向けの説明

**例え話**: テストの点数を予測する

あなたがクラスメイトのテストの点数を予測したいとします。
使える情報は：
- 前回のテスト点数 ⭐
- 勉強時間 ⭐
- 髪の毛の長さ ❌
- 好きな食べ物 ❌
- 通学時間 ❌
- 睡眠時間 ⭐

「髪の毛の長さ」や「好きな食べ物」は、テストの点数と **関係ない** ですよね？
だから、これらは **使わない** ことにします。

**Phase 7は、こういう「関係ない情報」を捨てる作業です。**

### 競馬で何をした？

競馬でも同じです。馬の勝敗を予測するために、こんな情報がありました：

**使える情報（46個）**:
- 騎手の名前
- 前回のレース順位
- 馬の年齢
- 天気
- 枠番
- コーナーでの位置
- などなど...

でも、**全部使うと、関係ない情報（ノイズ）が混ざって、予測が下手になります。**

だから、Phase 7で「本当に役立つ情報だけ」を選びました。

**結果**:
- 46個の情報 → **平均28個に絞った**
- 削除した情報: 平均18個（天気、枠番、トラック種別など）
- **Boruta（ボルタ）という方法**で、統計的に「役立つかどうか」を判定しました

### どうやって判定した？

**Borutaの仕組み（小学生向け）**:

1. **偽物の情報を作る**
   - 本物の情報をシャッフルして「偽物」を作ります
   - 例: 騎手の名前を [武豊, ルメール, 川田] → シャッフル → [ルメール, 武豊, 川田]
   - この偽物は「ランダムなノイズ」と同じです

2. **本物と偽物を比べる**
   - AIに「本物と偽物、どっちが予測に役立つ？」と聞きます
   - 本物の騎手名: 重要度 10,175
   - 偽物の騎手名: 重要度 522（シャドウ最大値）

3. **統計的に判定**
   - 10回やって、10回とも本物が勝つ → **採用！**
   - 10回やって、5回しか勝てない → **これは運が良かっただけ** → 削除

4. **新しく選ぶものがなくなったら終了**
   - 浦和の場合: 11回目で「もう選ぶものがない」→ 終了

**だから、Borutaは「無理やり削っていない」のです！**

---

## 🔧 Phase 8: 「AIの設定を調整する」

### 小学生向けの説明

**例え話**: 自転車の調整

自転車に乗るとき、サドルの高さやハンドルの位置を **自分に合わせて調整** しますよね？

- サドルが低すぎる → 漕ぎにくい
- サドルが高すぎる → 足が届かない
- **ちょうどいい高さ** → 一番速く走れる！

**Phase 8は、AIの「サドルの高さ」を調整する作業です。**

### 競馬で何をする？

AIには、たくさんの「設定（ハイパーパラメータ）」があります：

- **learning_rate（学習速度）**: AIがどれくらい速く学ぶか
  - 速すぎる → 間違いを覚える
  - 遅すぎる → 時間がかかる
  
- **num_leaves（葉の数）**: AIの「複雑さ」
  - 多すぎる → 細かすぎて訳わからない
  - 少なすぎる → 簡単すぎて役に立たない
  
- **max_depth（深さ）**: AIが「どこまで考えるか」
  - 深すぎる → 考えすぎて混乱
  - 浅すぎる → 簡単すぎる

**Phase 8では、Optuna（オプチュナ）という道具を使って、これらの設定を自動で調整します。**

### どうやって調整する？

**Optunaの仕組み（小学生向け）**:

1. **色々な設定を試す**
   - 設定A: learning_rate=0.01, num_leaves=31 → 精度75%
   - 設定B: learning_rate=0.05, num_leaves=50 → 精度78%
   - 設定C: learning_rate=0.03, num_leaves=40 → 精度80% ← **これが一番良い！**

2. **良い設定を記憶する**
   - Optunaは「どの設定が良かったか」を覚えて、次の試行に活かします

3. **100回くらい試す**
   - 100回試して、一番良い設定を見つけます

**結果**:
- 各競馬場に **最適な設定** が見つかります
- 予測精度が **5-10%向上** します

**所要時間**:
- 1競馬場あたり: 30-60分
- 14競馬場合計: 7-14時間

---

## 🤖 Phase 9: 「AIを訓練する」

### 小学生向けの説明

**例え話**: サッカーの練習

サッカーがうまくなるには、練習が必要ですよね？

- ドリブル練習
- シュート練習
- パス練習
- 試合で経験を積む

**Phase 9は、AIが「過去のレースデータ」で練習する作業です。**

### 競馬で何をする？

Phase 8で見つけた「最適な設定」を使って、AIを訓練します。

**訓練データ**:
- 過去5年間のレース結果（2020-2025）
- 浦和の場合: 43,303件のレースデータ

**AIが学ぶこと**:
- 「前回1位だった馬は、今回も強い」
- 「武豊騎手が乗ると勝率が高い」
- 「馬齢が4歳のときが一番強い」
- 「雨の日は、この馬が強い」

**訓練の流れ**:

1. **過去のデータを見る**
   - AIに「このレースで1位になった馬は、こういう特徴がありました」と教えます

2. **パターンを学ぶ**
   - AIは「どういう特徴があると勝ちやすいか」を学びます

3. **テストで確認**
   - AIに「じゃあ、このレースで勝つのは？」と聞いて、正解率を確認します

**結果**:
- 14競馬場 × 訓練済みAIモデル（14個）
- 各競馬場に特化したAIができます

---

## 🎯 Phase 10: 「予測して、賭ける」

### 小学生向けの説明

**例え話**: テストの点数予測

あなたが「友達のテストの点数」を予測できるようになったとします。
- 友達A: 90点と予測 → 実際: 92点 ⭐
- 友達B: 60点と予測 → 実際: 58点 ⭐
- 友達C: 80点と予測 → 実際: 65点 ❌

**予測が当たったら、友達にジュースをおごってもらう** ← これが「賭け」です

**Phase 10は、AIが予測した結果を使って、実際に賭ける作業です。**

### 競馬で何をする？

Phase 9で訓練したAIを使って、**明日のレース**を予測します。

**予測の流れ**:

1. **明日のレース情報を取得**
   - 浦和競馬場で明日レースがあります
   - 出走する馬: 10頭
   - 騎手、馬齢、前回の順位などの情報

2. **AIに予測させる**
   - AIは各馬の「勝つ確率」を予測します
   - 1番馬: 25%
   - 2番馬: 15%
   - 3番馬: 30% ← **一番高い！**
   - 4番馬: 10%
   - ...

3. **賭ける馬を選ぶ**
   - 勝つ確率が高い馬に賭けます
   - 例: 3番馬に1,000円

4. **結果を確認**
   - レースが終わったら、予測が当たったか確認します
   - 当たったら → お金が増える！
   - 外れたら → お金が減る...

**賭け方の種類**:
- **単勝**: 1位になる馬を予測
- **複勝**: 3位以内に入る馬を予測
- **馬連**: 1位と2位の馬を予測（順不同）
- **3連複**: 1位、2位、3位の馬を予測（順不同）

**Phase 10の目標**:
- **的中率**: 予測が当たる確率を高める
- **回収率**: 賭けたお金より多く返ってくる

---

## 📊 Phase 7〜10の全体像

### 料理で例えると...

**Phase 7（材料選び）**:
- 冷蔵庫にある材料を選ぶ
- 新鮮な野菜 ⭐ → 使う
- 腐った肉 ❌ → 捨てる

**Phase 8（レシピ調整）**:
- 塩の量、火加減を調整する
- 何度も試して、一番おいしいレシピを見つける

**Phase 9（料理の練習）**:
- レシピ通りに料理を練習する
- 何度も作って、上手になる

**Phase 10（お客さんに出す）**:
- 完成した料理をお客さんに出す
- おいしいと言ってもらえたら成功！

---

## 🚀 まとめ

| Phase | 何をする？ | 例え | 所要時間 |
|-------|-----------|------|----------|
| **Phase 7** | 使う情報を選ぶ | テストの点数予測に「髪の毛の長さ」は関係ない | 15-30分 |
| **Phase 8** | AIの設定を調整 | 自転車のサドルの高さを調整 | 7-14時間 |
| **Phase 9** | AIを訓練する | サッカーの練習 | 1-2時間 |
| **Phase 10** | 予測して賭ける | テストの点数を予測してジュースを賭ける | 毎日 |

---

## ✅ Phase 7完了！

**14競馬場全てで「使う情報」を選びました**

**結果**:
- 平均28.1個の情報を選択
- 平均17.9個の「関係ない情報」を削除
- 一番重要な情報: **騎手コード**（誰が乗るか）
- 2番目に重要: **前走着順**（前回のレース順位）

---

## 🎯 次: Phase 8実行！

**これから何をする？**

14競馬場全てに対して、**AIの設定を調整**します。

**実行コマンド**:
```batch
cd E:\anonymous-keiba-ai
RUN_PHASE8_ALL_VENUES.bat
```

**所要時間**: 7-14時間（夜間実行推奨）

**Phase 8が終わったら**:
- Phase 9: AIを訓練（1-2時間）
- Phase 10: 明日のレースを予測！

---

## 🎉 頑張りましょう！

Phase 7で「良い材料」を選んだので、Phase 8で「最高のレシピ」を見つければ、
Phase 9で「おいしい料理」が作れて、Phase 10で「お客さんに喜んでもらえる」はずです！

**準備はいいですか？Phase 8を実行します！** 🚀
